<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Link File Generator</title>
  <link rel="stylesheet" href="./styles.css" />

  <link rel="icon" href="./assets/favicon.svg" type="image/svg+xml">
  <!-- (icons later) -->
  <!-- <link rel="icon" href="./assets/icons/favicon.svg" type="image/svg+xml"> -->
</head>

<body>
  <main class="app">
    <div class="card">

      <!-- Header -->
      <header class="topbar">
        <div class="title-row">
          <h1>Link File Generator</h1>

            <div class="settings">

            <button id="settingsBtn" type="button" class="icon-btn" aria-label="Settings" aria-haspopup="menu" aria-expanded="false">
              <svg class="icon" aria-hidden="true" viewBox="0 0 24 24">
                <use href="#i-settings"></use>
              </svg>
            </button>

            <div id="settingsMenu" class="settings-menu" role="menu" hidden>
              <button id="themeToggleBtn" type="button" class="btn secondary small" role="menuitem">
                Toggle theme
              </button>

              <button id="factoryResetBtn" type="button" class="btn danger secondary small" role="menuitem">
                Factory reset
              </button>

              <div class="settings-divider"></div>

              <div class="settings-meta">
                Version <span id="appVersion">—</span>
                <span><br>Vibe coded entirely with ChatGPT 5.2</span>
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- Mode toggle -->
      <div class="setting-row mt-12">
        <label class="setting-label">Mode</label>

        <div class="choice-row setting-choices" role="radiogroup" aria-label="Mode">
          <label class="choice-pill">
            <input type="radio" name="mode" value="single" checked />
            <span class="choice-pill-title">Single</span>
          </label>

          <label class="choice-pill">
            <input type="radio" name="mode" value="batch" />
            <span class="choice-pill-title">Batch</span>
          </label>
        </div>
      </div>

      <div id="modeHelp" class="hint" style="margin-top:10px;"></div>

      <!-- File type selection -->
      <div class="setting-row mt-12">
        <label class="setting-label">File type</label>

        <div class="choice-row setting-choices" role="radiogroup" aria-label="File type">
          <label class="choice-pill">
            <input type="radio" name="fileType" value="html" checked />
            <span class="choice-pill-title">Redirect</span>
            <span class="choice-pill-sub">HTML</span>
          </label>

          <label class="choice-pill">
            <input type="radio" name="fileType" value="url" />
            <span class="choice-pill-title">Windows</span>
            <span class="choice-pill-sub">.url</span>
          </label>

          <label class="choice-pill">
            <input type="radio" name="fileType" value="webloc" />
            <span class="choice-pill-title">macOS</span>
            <span class="choice-pill-sub">.webloc</span>
          </label>
        </div>
      </div>

      <div id="fileTypeHelp" class="hint" style="margin-top:10px;"></div>

      <!-- URL handling selection -->
      <div class="setting-row mt-12">
        <label class="setting-label">URL handling</label>

        <div class="choice-row setting-choices" role="radiogroup" aria-label="URL handling">
          <label class="choice-pill">
            <input type="radio" name="urlMode" value="full" checked />
            <span class="choice-pill-title">Preserve</span>
            <span class="choice-pill-sub">Full</span>
          </label>

          <label class="choice-pill">
            <input type="radio" name="urlMode" value="stripTracking" />
            <span class="choice-pill-title">Strip</span>
            <span class="choice-pill-sub">Tracking</span>
          </label>

          <label class="choice-pill">
            <input type="radio" name="urlMode" value="stripAll" />
            <span class="choice-pill-title">Strip</span>
            <span class="choice-pill-sub">All</span>
          </label>
        </div>
      </div>

      <div id="urlModeHelp" class="hint" style="margin-top:10px;"></div>

      <!-- Single mode -->
      <section id="singlePanel" class="section">
        <label for="urlInput">URL</label>
        <input
          id="urlInput"
          type="text"
          inputmode="url"
          placeholder="https://example.com"
          autocomplete="off"
          spellcheck="false"
        />

        <div class="field-inline">
          <label for="fileName" class="field-label">Filename (optional)</label>
          <input
            id="fileName"
            class="field-input"
            type="text"
            placeholder="Leave blank to auto-name"
            autocomplete="off"
            spellcheck="false"
          />
        </div>

        <div class="hint">
          If blank, we’ll derive a safe name from the hostname (minus the TLD).
          Example: <code>fonts.google.com</code> → <code>fonts.google</code>
        </div>

        <div class="actions">
          <button id="downloadBtn" type="button" class="btn primary">
            <svg class="icon" aria-hidden="true">
              <use href="#i-download"></use>
            </svg>
            Download
          </button>

          <button id="copyBtn" type="button" class="btn secondary small">
            <svg class="icon" aria-hidden="true">
              <use href="#i-copy"></use>
            </svg>
            Copy normalized URL
          </button>

          <button id="openNowBtn" type="button" class="btn secondary small">
            <svg class="icon" aria-hidden="true">
              <use href="#i-open"></use>
            </svg>
            Open link now
          </button>

          <span class="spacer"></span>

          <button id="resetBtn" type="button" class="btn danger secondary small">
            <svg class="icon" aria-hidden="true">
              <use href="#i-clear"></use>
            </svg>
            Clear
          </button>
        </div>

        <!-- QR (single mode) -->
        <details id="qrDetails" class="details-card mt-12">
          <summary class="details-summary" id="qrSummary">
            <span class="details-summary-left">
              <span class="details-summary-title">QR code</span>
            </span>
          </summary>

          <div class="details-body">
            <!-- Header hint (optional) -->
            <div class="hint" style="margin-top:0;">
              QR uses the same URL mode as your downloads.
            </div>

            <div id="qrPanel" class="qr-panel-compact" hidden>
              <!-- Top row: preview left, actions right -->
              <div class="qr-top">
                <div class="qr-box">
                  <div class="qr-title">Preview</div>
                  <img id="qrImg" alt="QR code preview" />
                </div>
              </div>

              <!-- Warning -->
              <div id="qrWarn" class="hint qr-warn" style="display:none;">
                ⚠️ Low contrast — QR may be hard to scan.
              </div>

              <!-- Controls: compact rows -->
              <div class="qr-controls">
                <div class="qr-controls-row">
                  <label class="qr-inline">
                    <span class="qr-inline-label">Foreground</span>
                    <input id="qrFg" type="color" value="#000000" />
                  </label>

                  <label class="qr-inline">
                    <span class="qr-inline-label">Background</span>
                    <input id="qrBg" type="color" value="#ffffff" />
                  </label>

                  <label class="qr-inline qr-inline-check">
                    <input id="qrTransparent" type="checkbox" />
                    <span class="qr-inline-label">Transparent</span>
                  </label>
                </div>

                <div class="qr-controls-row">
                  <label class="qr-inline">
                    <span class="qr-inline-label">Border</span>
                    <input id="qrMargin" type="number" min="0" max="32" step="1" value="4" class="qr-num" />
                  </label>

                  <label class="qr-inline">
                    <span class="qr-inline-label">Size</span>
                    <select id="qrSize" class="select qr-select">
                      <option value="small">Small</option>
                      <option value="medium" selected>Medium</option>
                      <option value="large">Large</option>
                    </select>
                  </label>

                  <label class="qr-inline">
                    <span class="qr-inline-label">ECC</span>
                    <select id="qrEcc" class="select qr-select">
                      <option value="L">L</option>
                      <option value="M" selected>M</option>
                      <option value="Q">Q</option>
                      <option value="H">H</option>
                    </select>
                  </label>
                </div>
              </div>
            
              <div class="qr-actions-grid">
                <button id="qrCopyUrlBtn" type="button" class="btn secondary small">Copy URL</button>
                <button id="qrCopySvgBtn" type="button" class="btn secondary small">Copy SVG</button>
                <button id="qrDlPngBtn" type="button" class="btn primary small">Download PNG</button>
                <button id="qrDlSvgBtn" type="button" class="btn primary small">Download SVG</button>
              </div>
            </div>
          </div>
        </details>

      </section>

      <!-- Batch mode -->
      <section id="batchPanel" class="section" hidden>
        <label for="batchInput">URLs (one per line — or drop a CSV/JSON/batch file here)</label>
        <textarea
          id="batchInput"
          placeholder="https://example.com&#10;www.google.com&#10;fonts.google.com"
          spellcheck="false"
        ></textarea>

        <!-- Import bar -->
        <div id="dropZone" class="dropzone" tabindex="0" aria-label="Import files">
          <div class="dropzone-row">
            <div class="dropzone-text">
              <strong>Import:</strong> Drag &amp; drop a Batch File, CSV, or JSON
              <small>Supported: .json (batch/export/url list), .csv (url column), .txt (one URL per line)</small>
            </div>

            <button id="chooseImportBtn" type="button" class="btn secondary">Choose file</button>
            <input
              id="importAnyFileInput"
              type="file"
              accept=".json,.csv,.txt,application/json,text/csv,text/plain"
              hidden
            />
          </div>
        </div>

        <div class="field-inline">
          <label for="zipName" class="field-label">ZIP name (optional)</label>
          <input
            id="zipName"
            class="field-input"
            type="text"
            placeholder="Leave blank for links.zip"
            autocomplete="off"
            spellcheck="false"
          />
        </div>

        <div class="hint">
          If blank, we’ll derive a safe name from the hostname (minus the TLD).
          Example: <code>fonts.google.com</code> → <code>fonts.google</code>
        </div>

        <!-- Batch options (collapsible) -->
        <details id="batchOptionsDetails" class="details-card mt-12">
          <summary class="details-summary">
            <span class="details-summary-left">
              <span class="details-summary-title">Batch options</span>
            </span>
          </summary>

          <div class="details-body">
            <div class="options" style="margin-top:0;">
              <label class="option">
                <input type="checkbox" id="optImportAppend" checked />
                Append on import
              </label>

              <label class="option">
                <input id="optDedupe" type="checkbox" />
                Remove duplicates
              </label>

              <div id="dedupeStrengthWrap">
                <label class="mt-12">Deduping strength</label>
                <select id="dedupeMode" class="select">
                  <option value="exact" selected>Exact</option>
                  <option value="loose">Loose (ignore www + trailing slash)</option>
                  <option value="aggressive">Aggressive (canonical-ish)</option>
                </select>
                <div class="hint">
                  Loose is usually best. Aggressive may merge URLs you’d prefer to keep separate.
                </div>
              </div>

              <div class="divider"></div>

              <div class="hint">
                These control CSV/JSON exports and copy actions. (Batch File export stays standardized.)
              </div>

              <label class="option">
                <input id="optExportCsv" type="checkbox" checked />
                Include CSV export in ZIP
              </label>

              <label class="option">
                <input id="optExportJson" type="checkbox" checked />
                Include JSON export in ZIP
              </label>

              <label class="option">
                <input id="optQrPng" type="checkbox" />
                Include QR PNGs in ZIP
              </label>

              <label class="option">
                <input id="optQrSvg" type="checkbox" />
                Include QR SVGs in ZIP
              </label>

              <!-- Batch QR options -->
              <div id="batchQrOptions" class="batch-qr-options" hidden>
                <div class="hint" style="margin-top:0;">
                  These settings are shared with the single-mode QR section.
                </div>

                <div class="qr-controls" style="margin-top:10px;">
                  <div class="qr-controls-row">
                    <label class="qr-inline">
                      <span class="qr-inline-label">Foreground</span>
                      <input id="qrFgBatch" type="color" value="#000000" />
                    </label>

                    <label class="qr-inline">
                      <span class="qr-inline-label">Background</span>
                      <input id="qrBgBatch" type="color" value="#ffffff" />
                    </label>

                    <label class="qr-inline qr-inline-check">
                      <input id="qrTransparentBatch" type="checkbox" />
                      <span class="qr-inline-label">Transparent</span>
                    </label>
                  </div>

                  <div class="qr-controls-row">
                    <label class="qr-inline">
                      <span class="qr-inline-label">Border</span>
                      <input id="qrMarginBatch" type="number" min="0" max="32" step="1" value="4" class="qr-num" />
                    </label>

                    <label class="qr-inline">
                      <span class="qr-inline-label">Size</span>
                      <select id="qrSizeBatch" class="select qr-select">
                        <option value="small">Small</option>
                        <option value="medium" selected>Medium</option>
                        <option value="large">Large</option>
                      </select>
                    </label>

                    <label class="qr-inline">
                      <span class="qr-inline-label">ECC</span>
                      <select id="qrEccBatch" class="select qr-select">
                        <option value="L">L</option>
                        <option value="M" selected>M</option>
                        <option value="Q">Q</option>
                        <option value="H">H</option>
                      </select>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </details>

        <!-- Export schema -->
        <details id="exportSchemaDetails" class="details-card mt-12">
          <summary class="details-summary">
            <span class="details-summary-left">
              <span class="details-summary-title">Export schema</span>
            </span>
          </summary>

          <div class="details-body">
            <div class="hint" style="margin-top:0;">
              Pick fields to include, then drag to reorder. Applies to CSV + JSON exports (and ZIP exports).
            </div>

            <div class="schema-wrap">
              <div class="schema-col">
                <div class="schema-title">Selected (drag to reorder)</div>
                <ul id="exportFieldsSelected" class="schema-selected" aria-label="Selected export fields"></ul>
              </div>

              <div class="schema-col">
                <div class="schema-title">Available fields</div>
                <div id="exportFieldsAvailable" class="schema-available"></div>
              </div>
            </div>
          </div>
        </details>

        <div class="actions actions-stack">
          <!-- Row 1: Downloads + Clear -->
          <div class="actions-row">
            <button id="downloadZipBtn" type="button" class="btn primary">
              <svg class="icon" aria-hidden="true"><use href="#i-download"></use></svg>
              Download ZIP
            </button>

            <button id="downloadCsvBtn" type="button" class="btn secondary small">
              <svg class="icon" aria-hidden="true"><use href="#i-download"></use></svg>
              Download CSV
            </button>

            <button id="downloadJsonBtn" type="button" class="btn secondary small">
              <svg class="icon" aria-hidden="true"><use href="#i-download"></use></svg>
              Download JSON
            </button>

            <button id="downloadBatchFileBtn" type="button" class="btn secondary small">
              <svg class="icon" aria-hidden="true"><use href="#i-download"></use></svg>
              Download Batch File
            </button>

            <span class="actions-row-spacer"></span>

            <button id="resetBtnBatch" type="button" class="btn danger secondary small">
              <svg class="icon" aria-hidden="true"><use href="#i-clear"></use></svg>
              Clear
            </button>
          </div>

          <!-- Row 2: Copy + Open -->
          <div class="actions-row">
            <button id="copyBatchCsvBtn" type="button" class="btn secondary small">
              <svg class="icon" aria-hidden="true"><use href="#i-copy"></use></svg>
              Copy CSV
            </button>

            <button id="copyBatchJsonBtn" type="button" class="btn secondary small">
              <svg class="icon" aria-hidden="true"><use href="#i-copy"></use></svg>
              Copy JSON
            </button>

            <button id="copyBatchUrlsBtn" type="button" class="btn secondary small">
              <svg class="icon" aria-hidden="true"><use href="#i-copy"></use></svg>
              Copy URL list
            </button>

            <button id="openFirstBtn" type="button" class="btn secondary small">
              <svg class="icon" aria-hidden="true"><use href="#i-open"></use></svg>
              Open first valid
            </button>
          </div>
        </div>
      </section>
        


      <!-- Secondary / bottom stack -->
      <section class="bottom-stack">
        <div id="status" class="status" aria-live="polite"></div>

        <div id="invalidPanel" class="invalid-panel" hidden>
          <div class="invalid-head">
            <div class="invalid-title">
              Invalid lines <span id="invalidCount" class="muted"></span>
            </div>
            <button id="toggleInvalidBtn" type="button" class="btn secondary small">
              Show
            </button>
          </div>

          <div id="invalidBody" class="invalid-body" hidden>
            <div id="invalidList" class="invalid-list"></div>
            <div class="hint">
              Tip: Fix the lines above (or remove them) and the batch preview will update automatically.
            </div>
          </div>
        </div>

        <details id="historyDetails" class="history-details">
          <summary class="history-summary">
            <span class="history-summary-left">
              <span class="history-summary-title">History</span>
              <span id="historyCount" class="muted"></span>
            </span>

            <span class="history-summary-right">
              <button id="clearHistoryBtn" type="button" class="btn secondary small danger">Clear</button>
            </span>
          </summary>

          <div id="historyList"></div>
        </details>
      </section>

    </div>
  </main>

  <!-- Local/offline vendor libs -->
  <script src="./vendor/jszip.min.js"></script>
  <script src="./vendor/qrcode.js"></script>

  <!-- Lib files -->
  <script src="./lib/ui.js"></script>
  <script src="./lib/url.js"></script>
  <script src="./lib/batch.js"></script>
  <script src="./lib/batch-file.js"></script>
  <script src="./lib/import-json.js"></script>
  <script src="./lib/import-files.js"></script>
  <script src="./lib/qr.js"></script>
  <script src="./lib/export.js"></script>
  <script src="./lib/export-schema.js"></script>
  <script src="./lib/output-builders.js"></script>
  <script src="./lib/download.js"></script>
  <script src="./lib/zip.js"></script>
  <script src="./lib/errors.js"></script>
  <script src="./lib/actions.js"></script>
  <script src="./lib/history.js"></script>
  <script src="./lib/state.js"></script>
  <script src="./lib/theme.js"></script>

  <script src="./app.js"></script>

  <!-- ===================================================== -->
  <!-- SVG ICON SPRITE (shared icons) -->
  <!-- ===================================================== -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">

    <!-- Favicon / app icon -->
    <symbol id="i-link" viewBox="0 0 24 24">
      <path fill="currentColor" d="M6.17 6.309a5.317 5.317 0 0 1 7.522 0a5.326 5.326 0 0 1 0 7.529l-1.43 1.43a.75.75 0 0 0 1.06 1.061l1.43-1.431a6.826 6.826 0 0 0 0-9.65a6.817 6.817 0 0 0-9.644 0l-2.86 2.864A6.826 6.826 0 0 0 6.69 19.749a.75.75 0 1 0 .083-1.498a5.326 5.326 0 0 1-3.465-9.08z"/>
      <path fill="currentColor" d="M17.31 4.251a.75.75 0 0 0-.083 1.498a5.326 5.326 0 0 1 3.465 9.08L17.83 17.69a5.317 5.317 0 0 1-7.523 0a5.326 5.326 0 0 1 0-7.528l1.43-1.432a.75.75 0 0 0-1.06-1.06l-1.43 1.431a6.826 6.826 0 0 0 0 9.65a6.817 6.817 0 0 0 9.644 0l2.86-2.864A6.826 6.826 0 0 0 17.31 4.251"/>
    </symbol>

    <!-- Settings / overflow -->
    <symbol id="i-settings" viewBox="0 0 24 24">
      <path fill="currentColor" d="M12 16a2 2 0 0 1 2 2a2 2 0 0 1-2 2a2 2 0 0 1-2-2a2 2 0 0 1 2-2m0-6a2 2 0 0 1 2 2a2 2 0 0 1-2 2a2 2 0 0 1-2-2a2 2 0 0 1 2-2m0-6a2 2 0 0 1 2 2a2 2 0 0 1-2 2a2 2 0 0 1-2-2a2 2 0 0 1 2-2"></path>
    </symbol>

    <!-- Download -->
    <symbol id="i-download" viewBox="0 0 12 12">
      <path fill="none" stroke="currentColor" stroke-linecap="round"
        d="M1.5 11.5h9m-8-6l3.1 3.1c.2.2.5.2.7 0l3.1-3.1M6 8.5v-8"/>
    </symbol>

    <!-- Copy -->
    <symbol id="i-copy" viewBox="0 0 12 12">
      <path fill="currentColor"
        d="M11 4a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1zm0 1H5v6h6zM7 0a1 1 0 0 1 1 1v1.5a.5.5 0 0 1-1 0V1H1v6h1.5a.5.5 0 0 1 0 1H1a1 1 0 0 1-1-1V1a1 1 0 0 1 1-1z"/>
    </symbol>

    <!-- Open / new window -->
    <symbol id="i-open" viewBox="0 0 12 12">
      <path fill="none" stroke="currentColor" stroke-linecap="round"
        d="M10.5 8.5V10c0 .3-.2.5-.5.5H2c-.3 0-.5-.2-.5-.5V2c0-.3.2-.5.5-.5h1.5M6 6l4-4m-3.5-.5H10c.3 0 .5.2.5.5v3.5"/>
    </symbol>

    <!-- Clear / X -->
    <symbol id="i-clear" viewBox="0 0 16 16">
      <path fill="currentColor" stroke="currentColor" stroke-linecap="round" stroke-width="2"
        d="M3 13L13 3m0 10L3 3"/>
    </symbol>




  </svg>

</body>
</html>
